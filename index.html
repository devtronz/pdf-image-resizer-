<!DOCTYPE html>
<html>
<head>
  <title>Photo to PDF & Resizer</title>
</head>
<body>

<h2>Photo → PDF</h2>
<input type="file" multiple accept="image/*" id="images">
<button onclick="makePDF()">Convert to PDF</button>

<hr>

<h2>Resize Image</h2>
<input type="file" accept="image/*" id="resizeImg">
<input type="number" id="width" placeholder="Width">
<button onclick="resize()">Resize</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
const WORKER_URL = "https://YOUR-WORKER-NAME.workers.dev";

function log(action, count = 0) {
  fetch(WORKER_URL + "/log", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      action: action,
      fileCount: count
    })
  });
}

// PHOTO → PDF
async function makePDF() {
  const files = document.getElementById("images").files;
  if (!files.length) return alert("Select images");

  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();

  for (let i = 0; i < files.length; i++) {
    const img = await loadImage(files[i]);
    const w = pdf.internal.pageSize.getWidth();
    const h = (img.height * w) / img.width;

    if (i > 0) pdf.addPage();
    pdf.addImage(img, "JPEG", 0, 0, w, h);
  }

  pdf.save("images.pdf");
  log("photo_to_pdf", files.length);
}

function loadImage(file) {
  return new Promise(res => {
    const r = new FileReader();
    r.onload = () => {
      const img = new Image();
      img.onload = () => res(img);
      img.src = r.result;
    };
    r.readAsDataURL(file);
  });
}

// IMAGE RESIZER
function resize() {
  const file = document.getElementById("resizeImg").files[0];
  const width = parseInt(document.getElementById("width").value);
  if (!file || !width) return alert("Select image & width");

  const img = new Image();
  const r = new FileReader();

  r.onload = () => {
    img.onload = () => {
      const canvas = document.createElement("canvas");
      canvas.width = width;
      canvas.height = img.height * (width / img.width);
      canvas.getContext("2d").drawImage(img, 0, 0, canvas.width, canvas.height);

      const a = document.createElement("a");
      a.href = canvas.toDataURL("image/jpeg");
      a.download = "resized.jpg";
      a.click();

      log("image_resize", 1);
    };
    img.src = r.result;
  };
  r.readAsDataURL(file);
}
</script>

</body>
</html>
